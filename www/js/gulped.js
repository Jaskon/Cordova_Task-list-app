angular.module("myFilters.isUnique",[]).filter("isUnique",function(){return function(t,e,r){var a=0;return t.forEach(function(t){t[e]===r&&a++}),!(a>1)}}),angular.module("myFilters.elemInObjsEqualsToCount",[]).filter("elemInObjsEqualsToCount",function(){return function(t,e,r){var a=0;return t.forEach(function(t){t[e]===r&&a++}),a}}),angular.module("myFilters.objsWithMinVariable",[]).filter("objsWithMinVariable",function(){return function(t,e){if(void 0==t[0])return t;var r,a=t[0][e];for(r=1;r<t.length;r++)t[r][e]<a&&(a=t[r][e]);var n=[];for(r=0;r<t.length;r++)t[r][e]===a&&n.push(t[r]);return n}});var appModule=angular.module("taskListApp",["ui.router","ngAnimate","mainPage","taskList"]);angular.module("taskListApp").controller("headerController",["$scope","tasksModel","$http","$timeout",function(t,e,r,a){t.menuList=[{name:"Main page",link:"#!/mainpage",active:!1},{name:"List of tasks",link:"#!/tasklist",active:!1}],t.$on("pageChanged",function(e,r){t.menuList.forEach(function(t){t.name===r.name?t.active=!0:t.active=!1})}),t.httpErrorText="",t.responseError={state:!1,timer:{}},t.$on("responseError",function(e){1==t.responseError.state&&0===t.responseError.timer.$$state.status&&(a.cancel(t.responseError.timer),t.responseError.state=!1),a(function(){t.httpErrorText="Received an error from the server",t.responseError.state=!0,t.responseError.timer=a(function(){t.responseError.state=!1},3300)},0)}),t.requestError={state:!1,timer:{}},t.$on("requestError",function(e){1==t.requestError.state&&0===t.requestError.timer.$$state.status&&(a.cancel(t.requestError.timer),t.requestError.state=!1),a(function(){t.httpErrorText="Something did wrong while requesting server",t.requestError.state=!0,t.requestError.timer=a(function(){t.requestError.state=!1},3300)},0)}),t.updateData=function(){e.updateDataFromDB()},t.loading=!1;var n;t.$watch(function(){return e.currentRequests.length},function(){e.currentRequests.length>0?t.loading||n&&0===n.$$state.status||(n=a(function(){t.loading=!0},500)):(n&&0===n.$$state.status&&a.cancel(n),t.loading=!1)})}]),angular.module("taskListApp").config(["$stateProvider","$urlRouterProvider","$locationProvider","$httpProvider",function(t,e,r,a){r.hashPrefix("!"),t.state("mainpage",{url:"/mainpage",template:"<main-page-component></main-page-component>"}).state("tasklist",{url:"/tasklist",template:"<task-list-component></task-list-component>"}),e.otherwise("/mainpage")}]),angular.module("taskListApp").factory("tasksModel",["$rootScope","$http",function(t,e){var r=[],a=function(t,r,a){e.post(t,r).then(function(t){a&&a(t)},function(e){console.log(["Error while doing ",t," request:"].join("")),console.log(e.config.data)})},n=function(t){a("/updateTasks",r,t)},o=function(t,e){a("/updateTask",t,e);for(var n=0;n<r.length;n++)if(r[n]._id===t._id){for(var o in t)r[n][o]=t[o];break}},s=function(t,e){a("/insertTask",{task:t},function(r){t._id=r.data._id,e&&e()}),r.push(t)},i=function(t,e){a("/deleteTask",{task:t},e);for(var n=0;n<r.length;n++)if(r[n]._id===t._id){r.splice(n,1);break}},u=function(){var a;e.get("/getTasks").then(function(t){var e=new Array(r.length);for(a=0;a<r.length;a++)e[a]=0;var n=new Array(t.data.length);for(a=0;a<t.data.length;a++)n[a]=0;for(r.forEach(function(r,a){t.data.forEach(function(t,o){r._id===t._id&&r.severity===t.severity&&r.text===t.text&&r.completed===t.completed&&(e[a]=1,n[o]=1)})}),a=e.length-1;a>=0;a--)0===e[a]&&r.splice(a,1);for(a=0;a<n.length;a++)0===n[a]&&r.push(t.data[a])},function(e){t.$broadcast("responseError"),console.log("Error while updating data from DataBase:"),console.log(e)})};return u(),{tasks:r,dbUpdateAll:n,dbUpdate:o,dbInsert:s,dbDelete:i,updateDataFromDB:u,currentRequests:e.pendingRequests}}]),angular.module("mainPage",["ui.router","myFilters.elemInObjsEqualsToCount","myFilters.objsWithMinVariable"]),angular.module("mainPage").component("mainPageComponent",{templateUrl:"mainPage.template.html",controller:["$scope","$rootScope","$stateParams","$timeout","tasksModel",function(t,e,r,a,n){e.$broadcast("pageChanged",{name:"Main page"}),t.tasks=n.tasks;var o=function(){t.date=Date.now(),a(o,1e3)};o()}]}),angular.module("taskList",["ui.router","angular.filter","myFilters.isUnique","taskListApp"]);var taskListComponentController=function(t,e,r,a){var n=function(e){t.tempTask[e._id]={},t.tempTask[e._id].severity=e.severity+"",t.tempTask[e._id].text=e.text,e.editing=!0},o=function(e){return""===t.tempTask[e._id].text?void alert("Enter something in task's text field!"):(e.severity=+t.tempTask[e._id].severity,e.text=t.tempTask[e._id].text,e.editing=!1,void a.dbUpdate(e))},s=function(t,e){t.ctrlKey&&13==t.keyCode&&o(e)},i=function(t){t.editing=!1},u=function(t){a.dbDelete(t)},l=function(t){a.dbUpdate(t)},c=function(){return t.taskToCreate.text&&t.taskToCreate.severity?(t.taskToCreate.severity=+t.taskToCreate.severity,t.taskToCreate.severity||(t.taskToCreate.severity=0),a.dbInsert({severity:t.taskToCreate.severity,text:t.taskToCreate.text,completed:!1,editing:!1}),t.taskToCreateIsInvalid=!1,t.taskToCreate.severity="",void(t.taskToCreate.text="")):void(t.taskToCreateIsInvalid=!0)};e.$broadcast("pageChanged",{name:"List of tasks"}),t.tasks=a.tasks,t.tempTask=[],t.taskToCreate={severity:"",text:""},t.taskToCreateIsInvalid=!1,t.editTask=n,t.saveEditTask=o,t.ctrlEnter_SaveEditTask=s,t.cancelEditTask=i,t.deleteTask=u,t.changeCompleteState=l,t.createTask=c};angular.module("taskList").component("taskListComponent",{templateUrl:"taskList.template.html",controller:["$scope","$rootScope","$stateParams","tasksModel",taskListComponentController]});